<h3>Enter Transaction | ${tmpl.transactionType}</h3>
<div class="padded">
<label class="label" for="amount">Amount</label>
<input type="number" id="amount" step=".01" min="0">
</div>

<div class="padded">
<label class="label" for="transaction-date">Transaction Date</label>
<input type="date" id="transaction-date">
</div>

${tmpl.contactTypes}

<div class="padded">
<label class="label" for="contributor_id">Contact Look-up</label>
<input id="contributor_id" type="text" class="combo__input" list="contributors">
<datalist id="contributors">
  <option>none of these, add new</option>
</datalist>
</div>
<div id="result-found" class="message message--success" style="display:none">
<p id="result-name"><p>
<p>
  <span id="result-city"></span>, <span id="result-state"></span>, <span id="result-zip"></span>
</p>
<p id="result-occupation"></p>
<p id="result-employer"></p>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script>
$("#contributor_id").on("input", function(e) {
    var val = $(this).val();
    if(val.length < 3) return;
    $.getJSON('https://api.open.fec.gov/v1/schedules/schedule_a/?api_key=' +
        API_KEY + '&contributor_name=' + val + '&entity_type=' + entity_type,
      function(res) {
        matches = res.results.filter(function(result) {
            return result.contributor_name === val;
        })
        if(matches.length > 0) {
          $('#manual-entry').hide();
          $('#result-name').text(matches[0].contributor_name);
          $('#result-city').text(matches[0].contributor_city);
          $('#result-state').text(matches[0].contributor_state);
          $('#result-zip').text(matches[0].contributor_zip);
          $('#result-occupation').text(matches[0].contributor_occupation);
          $('#result-employer').text(matches[0].contributor_employer);
          $('#contributor_id').css('background-color', 'lightgreen')
          $('#result-found').show();
        } else {
          $('#contributor_id').css('background-color', '')
          $('#manual-entry').show();
          $('#result-found').hide();
        }
        var dataList = $("#contributors");
        dataList.empty();
        if(res.results.length) {
          for(var i=0; i <res.results.length; i++) {
            var opt = $("<option></option>").attr("value", res.results[i].contributor_name);
            dataList.append(opt);
          }
        }
    });
  });
</script>

<div id="manual-entry">
<div class="padded">
<label class="label" for="name">Name</label>
<input type="text" id="name">
</div>

<div class="padded">
<label class="label" for="address">Address</label>
<input type="text" id="address">
</div>

<div class="padded">
<label class="label" for="zip">Zip</label>
<input type="text" id="zip">
</div>

<div class="padded">
<label class="label" for="city">City</label>
<input type="text" id="city">
</div>

<div class="padded">
  <label class="label" for="state">State</label>
  <select id="state" name="state">
  	<option value="AL">Alabama</option>
  	<option value="AK">Alaska</option>
  	<option value="AZ">Arizona</option>
  	<option value="AR">Arkansas</option>
  	<option value="CA">California</option>
  	<option value="CO">Colorado</option>
  	<option value="CT">Connecticut</option>
  	<option value="DE">Delaware</option>
  	<option value="DC">District of Columbia</option>
  	<option value="FL">Florida</option>
  	<option value="GA">Georgia</option>
  	<option value="HI">Hawaii</option>
  	<option value="ID">Idaho</option>
  	<option value="IL">Illinois</option>
  	<option value="IN">Indiana</option>
  	<option value="IA">Iowa</option>
  	<option value="KS">Kansas</option>
  	<option value="KY">Kentucky</option>
  	<option value="LA">Louisiana</option>
  	<option value="ME">Maine</option>
  	<option value="MD">Maryland</option>
  	<option value="MA">Massachusetts</option>
  	<option value="MI">Michigan</option>
  	<option value="MN">Minnesota</option>
  	<option value="MS">Mississippi</option>
  	<option value="MO">Missouri</option>
  	<option value="MT">Montana</option>
  	<option value="NE">Nebraska</option>
  	<option value="NV">Nevada</option>
  	<option value="NH">New Hampshire</option>
  	<option value="NJ">New Jersey</option>
  	<option value="NM">New Mexico</option>
  	<option value="NY">New York</option>
  	<option value="NC">North Carolina</option>
  	<option value="ND">North Dakota</option>
  	<option value="OH">Ohio</option>
  	<option value="OK">Oklahoma</option>
  	<option value="OR">Oregon</option>
  	<option value="PA">Pennsylvania</option>
  	<option value="RI">Rhode Island</option>
  	<option value="SC">South Carolina</option>
  	<option value="SD">South Dakota</option>
  	<option value="TN">Tennessee</option>
  	<option value="TX">Texas</option>
  	<option value="UT">Utah</option>
  	<option value="VT">Vermont</option>
  	<option value="VA">Virginia</option>
  	<option value="WA">Washington</option>
  	<option value="WV">West Virginia</option>
  	<option value="WI">Wisconsin</option>
  	<option value="WY">Wyoming</option>
  </select>
</div>

<div class="padded">
<label class="label" for="employer">Employer</label>
<input type="text" id="employer">
</div>

<div class="padded">
<label class="label" for="occupation">Occupation</label>
<input type="text" id="occupation">
</div>

</div>

<!-- buttons !-->
<div class="padded t-centered">
  <p><button id="add-another" class="button--cta" style="width:80%">Save and add another</button></p>
  <p><button id="save-and-finish" class="button--standard" style="width:80%">Save and finish</button><p>
  <p><a href="select-transaction-type.html">cancel</a></p>
</div>
<script>
  function saveTransaction() {
    var reportData = JSON.parse(localStorage.getItem('reportData'));
    var entry = {'name': $('#result-name').text() || $('#name').val(),
                  'city': $('#result-city').text() || $('#city').val(),
                  'state': $('#result-state').text() || $('#zip').val(),
                  'amount': $('#amount').val(),
                  'date': $('#transaction-date').val(),
                  'occupation': $('#result-occupation').text() || $('#occupation').val(),
                  'employer': $('#result-employer').text() || $('#employer').val(),
                  'type': 'receipt',
                  'entityType': entity_type}
    if(reportData) {
        reportData.push(entry)
    } else {
        reportData = [entry]
    }

    localStorage.setItem('reportData', JSON.stringify(reportData));
  }

  document.getElementById('add-another').addEventListener('click', function() {
      saveTransaction();
      location.reload();
  });

  document.getElementById('save-and-finish').addEventListener('click', function() {
    saveTransaction();
    window.location.href = 'ready-to-submit.html';
  })
</script>
